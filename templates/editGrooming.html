<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Manage Products</title>
    <link rel="stylesheet" href="https://stackpath.bootstrapcdn.com/bootstrap/4.5.2/css/bootstrap.min.css">
    <!-- <link rel="stylesheet" href="{{ url_for('static', filename='styles.css') }}"> -->
</head>
<body>

    {% include 'sidebar.html' %}
    <div class="container">
        <h2 class="mt-4 mb-4">Layanan Grooming</h2>
        <div class="row" id="product-cards">
            {% for product in products %}
            <div class="col-md-4 mb-4">
                <div class="card">
                    <div class="card-body">
                        <h5 class="card-title">{{ product.name }}</h5>
                        <p class="card-text">Type: {{ product.type }}</p>
                        <p class="card-text">Category: {{ product.category }}</p>
                        <p class="card-text">Quantity: {{ product.quantity }}</p>
                        <p class="card-text">Price: {{ product.price }}</p>
                        <img src="{{ url_for('uploads', filename=product.image) }}" class="card-img-top" alt="Product Image">
                        <button class="btn btn-primary edit-btn" data-productid="{{ product._id }}">Edit</button>
                        <button class="btn btn-success save-btn d-none" data-productid="{{ product._id }}">Save</button>
                    </div>
                </div>
            </div>
            {% endfor %}
        </div>
    </div>

    <script src="https://code.jquery.com/jquery-3.5.1.min.js"></script>
    <script>
        $(document).ready(function() {
            // Handle Edit button click
            $('.edit-btn').click(function() {
                var card = $(this).closest('.card-body');
                var saveBtn = card.find('.save-btn');
                var editBtn = card.find('.edit-btn');

                // Toggle buttons visibility
                saveBtn.removeClass('d-none');
                editBtn.addClass('d-none');

                // Make fields editable
                card.find('p.card-text').each(function() {
                    var text = $(this).text().trim();
                    var input = $('<input class="form-control" value="' + text + '">');
                    $(this).replaceWith(input);
                });
            });

            // Handle Save button click
            $('.save-btn').click(function() {
                var card = $(this).closest('.card-body');
                var saveBtn = card.find('.save-btn');
                var editBtn = card.find('.edit-btn');

                // Toggle buttons visibility
                saveBtn.addClass('d-none');
                editBtn.removeClass('d-none');

                // Extract updated values
                var product_id = $(this).data('productid');
                var updatedData = {
                    product_id: product_id,
                    name: card.find('input:eq(0)').val(),
                    type: card.find('input:eq(1)').val(),
                    category: card.find('input:eq(2)').val(),
                    quantity: card.find('input:eq(3)').val(),
                    price: card.find('input:eq(4)').val()
                };

                // Perform AJAX request to update product
                $.ajax({
                    url: '/api/update-product/' + product_id,
                    method: 'POST',
                    contentType: 'application/json',
                    data: JSON.stringify(updatedData),
                    success: function(response) {
                        alert('Product updated successfully');
                        // You can optionally refresh the page or update specific parts
                        // of the page based on your needs.
                    },
                    error: function(xhr, status, error) {
                        alert('Failed to update product: ' + error);
                    }
                });

                // Restore original text display
                card.find('input').each(function() {
                    var value = $(this).val();
                    var p = $('<p class="card-text">' + value + '</p>');
                    $(this).replaceWith(p);
                });
            });
        });
    </script>
</body>
</html>
